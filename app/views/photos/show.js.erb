$('#replaceable').hide(0, function() {
  $('#replaceable').html("<%= j render('photo_with_context', photo: @photo) %>");
  $('#main-photo').setMaxHeight($(window).height()-85);
  $('body.photos-show').setFadeAble('div.context-item', 'a.control');
  $('body.photos-show').setFadeAble('#photo-container', '.nav span');
  $('body.photos-show').setFadeAble('#photo-container', '.votes');
  $('div.hidden-cache').cacheImages();
  <% href = @context ? in_photo_path(@photo, context_serialize(@context)) : photo_path(@photo) %>
  document.title = '<%= @photo.title.unpack('U*').map{ |i| "\\u" + i.to_s(16).rjust(4, '0') }.join %>';
  window.history.pushState({page:"<%= href %>"}, document.title, "<%= href %>");
}).show(0);