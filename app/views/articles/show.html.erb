<div class="container">
<div class="page-header">
  <h1><%= @article.title %>
    <%= link_to @article.user.name, user_path(@article.user), class: "btn btn-warning btn-xs" %>
    <% if admin_or_current?(@article.user) %>
      <%= link_to edit_user_article_path(@article.user, @article), class: "btn btn-danger btn-xs" do %>
        <span class='glyphicon glyphicon-edit'></span></a>
      <% end %>
      <%= link_to [@article.user, @article], data: { confirm: "Are you sure?" }, class: "btn btn-danger btn-xs", :method => "delete" do %>
        <span class='glyphicon glyphicon-trash'></span>
      <% end %>
    <% end %>
  </h1>
</div>

<%=
  @article.content.gsub(/\{\{photo#(\d+)\}\}/) do |m|
    if @article.user.photos.exists?($1)
      photo = @article.user.photos.find($1)
      "<div class=\"article-photo-container\">"+
        "<img src=\"#{image_photo_url(photo)}\">"+
        "<div class=\"caption\">#{photo.title}</div>"+
      "</div>"
    else
      m
    end
  end.html_safe
%>

<% if @article.user.photos.any? %>
  <hr>
  Photos attached:
  <br>
  <% @article.user.photos.each do |photo| %>
    <%= image_tag image_photo_url(photo, :thumb) %>
  <% end %>
<% end %>

</div>